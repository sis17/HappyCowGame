---
layout: post
title: Week 8 - 16th-20th March.
categories: [progress]
---

### Mid-Project Demonstration
This was on the Tuesday of the week (the 17th). I took some time preparing for that.

### Card Rules
The various cards that Gabi invented need to have their rules implemented, so their actions are automatically carried out. In some cases this is simple, as when moving a ration, or changing how much a type of ingredient is worth.

However, in other cases, it proves quite complex. For example, the thief card demands that the player chooses ingredients in their hand to replace with somebody else's ration. This would require another popup where the user can select which ingredients to use and take.

The short term solution is to lean towards making the effects of cards random, so instead of getting to chose a ration or cards, the effect happens to a randomly chosen ration.

The other difficult aspect is keeping all the cow details up to date. Some effects of cards and events happen straight away, others cause events such as pregnancy, or ration movement which only happen later. When multiple events happen, the system needs to know if the cow is constipated, or what the weather is to check how rations should move.

Then there is the updating of the welfare, body condition and rumen PH markers. When one action causes a change in body condition for example, there may be a knock on effect on the welfare. A centralised part of the system needs to check these reactions and update the server.

### Testing
I began getting friends to test the game. The biggest confusion was what to do once a game is created, so how to play. To solve this I added instructions and help buttons.

### Cow Information
How to keep everything up to date and render it correctly to the server. When events happen, cards are played, and rations move, it can effect the markers or events around the cow. These need to be monitored, as one event changing, such as the cow PH marker, will have consequenses on the welfare of the cow.

The best solution is to have methods for updating cow information, instead of accessing the cow information markers directly. This allows the system to check the status, or update values in other cow markers within these methods.

Certain events change depending on the state of the cow, these cannot be changed when the cow changes, but must check the status of the cow and react accordingly. To do this I also created various check methods. Mostly these are to check the main states the cow can be in (pregnant, weather, disease). These check are then used when rations are moved, or certain cards are played.

### Unit Testing
As I implemented card and event functionality it became harder and harder to test the game by playing it, as some events didn't come up for some time, or other circumstances weren't correct for testing certain apsects. It was therefore time to begin formal testing. To do this I started with the model layer of the application, as this allowed the simplest Unit Testing to be done. Further more, this encouraged me to move functionality from the controllers to the models, where it should belong.

Rails provides a good environment for unit testing through the use of fixtures, which are easy to create test data that is cleared and entered into the database for each test file run. This made it easy to set up a few different scenarios to test a game as it begins, and during various stages of play.

I wrote tests for the Cow, Game, Ration and Event classes. These are the most complex of the classes, with varied interaction around updating cow information, so were a good place to start.
