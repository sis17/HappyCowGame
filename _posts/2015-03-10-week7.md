---
layout: post
title: Week 7 - 9th-13th March.
categories: [progress]
---

### UI fixes and Game rules
After getting the main progress of the game in place, so that players can move from turn to turn, create and delete games, there are a host of rules and UI improvements that need to be put into place.

#### Ration Placement
One of these is that rations must appear in the trough, but only if there is a free space, and then directly after any existing rations. I implemented this. This means there is no links in positions between positions in the trough, rations are instead moved automatically.

Then there is the problem of rations being able to move on top of each other. I prevented this by maintaining a list of ration positions. When the positions are requested for a dice number, positions with existing rations on (in that same game) are excluded from the list.

### Ration movement
I initially thought this worked with a simple graph returned from the server. However, the problem proved more complicated.

The issue is that the server returned positions from the specified position, but a position could appear several times if it could be moved to from several other positions. When that map of positions was drawn on the board, positions over-lapped each other. Because the positions were assembled recursively, the order they appeared was not out from the starting position, but in strings or paths.

The solution was to request positions from the server, and then create a hash table of all the positions, with links to other positions. This was essentially a graph on the client side, but where no positions repeated. To draw the available places to move was then a matter of traversing the graph non-recursively, so that positions appeared in the correct order.

### Alerts service
I took the quickly created alert code I made previously and turned it into a service. This meant that any part of the client side code can quickly make an alert that is managed by the service and can automatically fade away. It took a while to get used to the idea of services in AngularJS.

### Positions in the Database
This was a tedious task that had to be done this week. After testing the game with Gabi and Amanda, I realised any more testing would require all the positions to be set up to allow rations to fully navigate the cow's intestines. This meant finding the x and y coordinates of each position and entering it into the database, and then also providing the join information between positions (especially tedious in the rumen).

It has worked well since finished, however. The position design works well.

### Rations Absorbed
This functionality was created this week. It was a matter of checking the position of a ration when it is updated (so when it has finished moving). If it is in the milk, meat or final position it is scored appropriately by looking up the current ingredient values in the cow, and the user is then notified.

### Turn Updates
Another thing from the meeting with Amanada and Gabi was the fact that users need to be notified when others finish a turn, and it is then their turn to go. Previously it required a page refresh.

The quick implementation is to get the page to request an update for the game, round and cow information ever few seconds. This works well. In the future I need to look into getting the server to initiate the update.

###
