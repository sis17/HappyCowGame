<div class="bar bar-dark bar-top">
  <div class="pull-left">
    <img class="cow-icon pull-left" alt="Happy Cow icon" src="images/happycow.png" />
    <h2 class="title pull-left">{{$storage.user.name}}'s Games</h2>
    {{debug()}}
  </div>
  <ul class="list-inline pull-right">
    <li><a href="#/profile" class="btn btn-default">Profile</a></li>
    <li><button ng-click="instructions()" class="btn btn-success">Instructions</button></li>
    <li><button ng-click="user.logout()" class="btn btn-warning">Logout</button></li>
  </ul>
</div>

<div id="games" ng-controller="GamesCtrl">
  <div class="container">
    <div class="row">
      <div class="col-md-6"><h3>Games List</h3></div>
      <div class="col-md-6">
        <div class="btn-group pull-right">
          <button ng-click="newGame()" class="btn btn-success">New Game</button>
        </div>
      </div>
    </div>
    <hr />
    <div class="row">
      <div class="col-md-7">
        <div>
          <ul class="nav nav-tabs nav-justified">
            <li class="{{selectedGameFilter == 0 ? 'active':''}}">
              <a ng-click="selectedGameFilter = 0">Setting Up <span class="badge">{{countGameType(0)}}</span></a>
            </li>
            <li class="{{selectedGameFilter == 1 ? 'active':''}}">
              <a ng-click="selectedGameFilter = 1">Playing <span class="badge">{{countGameType(1)}}</span></a>
            </li>
            <li class="{{selectedGameFilter == 2 ? 'active':''}}">
              <a ng-click="selectedGameFilter = 2">Finished <span class="badge">{{countGameType(2)}}</span></a>
            </li>
            <li  class="{{selectedGameFilter == 3 ? 'active':''}}">
              <a ng-click="selectedGameFilter = 3">Failed <span class="badge">{{countGameType(3)}}</span></a>
            </li>
          </ul>
        </div>
        <table class="table">
          <tr>
            <th>Name</th><th>Score</th><th>Stage</th><th>Players</th>
            <th ng-if="selectedGameFilter == 1">Round</th>
            <th ng-if="selectedGameFilter == 1">Phase</th>
            <th ng-if="selectedGameFilter == 1">Turn</th>
          </tr>
          <tr ng-repeat="game_user in game_users | orderBy:'-game.start_time'" class="clickable" ng-click="selectGame(game_user)" ng-if="filterGame(game_user.game)">
            <td>{{game_user.game.name}}</td>
            <td>{{game_user.score}}</td>
            <td>
              <span ng-if="game_user.game.stage < 1" class="label label-warning">Setup</span>
              <span ng-if="game_user.game.stage == 1" class="label label-success">Playing</span>
              <span ng-if="game_user.game.stage > 1 " class="label label-{{game_user.game.stage == 2 ? 'info' : 'danger' }}">Finished</span>
            </td>
            <td>{{game_user.game.game_users.length}}</td>
            <td ng-if="game_user.game.stage == 1">{{game_user.game.round.number}}</td>
            <td ng-if="game_user.game.stage == 1">{{translatePhase(game_user.game.round.current_phase)}}</td>
            <td ng-if="game_user.game.stage == 1">
                <span class="label" style="background-color: {{game_user.game.round.game_user.colour}}">
                  {{game_user.game.round.game_user.user.name}}
                </span>
            </td>
          </tr>
        </table>
      </div>
      <div class="col-md-5">
        <div ng-if="game" class="well game-review">
          <h3>{{game.name}} Details</h3>
          <div class="container">
            <div class="row">
              <div class="col-md-6">
                <div ng-if="game.stage >= 1">
                  <dt>{{game.stage > 1 ? 'Duration':'Begin Time'}}</dt>
                    <dd>{{getDate(game)}}</dd>
                  <dt>Round Number</dt><dd>{{game.rounds.length}}</dd>
                  <div ng-if="game.stage == 1">
                    <dt>Current Round</dt><dd>{{game.round.number}}</dd>
                    <dt>Current Phase</dt><dd>{{translatePhase(game.round.current_phase)}}</dd>
                    <dt>Current Player</dt>
                      <dd>
                        <span class="label label-default" style="background-color:{{game.round.game_user.colour}};">
                          {{game.round.game_user.user.name}}
                        </span>
                      </dd>
                  </div>
                </div>
              </div>
              <div class="col-md-6">
                <h4>Players</h4>
                <ul class="dl-horizontal">
                  <li ng-repeat="game_user in game.game_users">
                    <span class="label label-default " style="background-color:{{game_user.colour}};">
                      {{game_user.user.name}}
                    </span>
                     - Score <span class="badge">{{game_user.score}}</span>
                  </li>
                </ul>
              </div>
            </div>
            <div class="row">
              <div class="col-md-4">
                <a ng-if="game_user.game.stage >= 1" ng-href="#/games/review/{{game.id}}" class="btn btn-default">Stats</a>
              </div>
              <div class="col-md-8">
                <div ng-if="game.stage <= 1" class="btn-group pull-right">
                  <button ng-if="user.isCreator(game) && game.stage == 0" ng-click="abandon(game.id)" class="btn btn-warning">Abandon</button>
                  <button ng-if="!user.isCreator(game) || game.stage > 0" ng-click="leave()" class="btn btn-warning">Leave</button>
                  <a ng-href="#/games/setup/{{game.id}}" class="btn btn-primary">
                    {{game.stage == 0 ? 'Setup' : 'Resume'}}
                  </a>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <hr />
    <div class="row">
      <div class="col-md-12">
        Total: <span class="badge">{{game_users.length}}</span>
      </div>
    </div>
  </div>
</div>

<script type="text/ng-template" id="leaveGame.html">
  <div class="modal-header">
    <h4 class="modal-title">Are you sure?</h4>
  </div>
  <div class="modal-body">
    <p>
      Are you sure you want to leave the game '{{game.name}}'?
      <span ng-if="game.stage == 0">You cannot rejoin the game without being re-invited.</span>
      <span ng-if="game.stage > 0">This game has begun, so there is no way to rejoin it.</span>
    </p>
  </div>
  <div class="modal-footer">
    <div class="btn-group">
      <button class="btn btn-danger" ng-click="yes()">Yes</button>
      <button ng-click="cancel()" class="btn btn-info">No</button>
    </div>
  </div>
</script>
