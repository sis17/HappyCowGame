<div ng-controller="CardsCtrl" class="cards">
<h2>
  Card Deck
  <small>Total <span class="badge">{{cards.$object.length}}</span></small>
  <small>Actions <span class="badge">{{countActions()}}</span></small>
  <small>Ingredients <span class="badge">{{countIngredients()}}</span></small>
</h2>
<div class="well well-sm">
  <ul id="cards-list" class="list-inline">
    <li ng-repeat="game_user_card in cards.$object" class="{{game_user_card.used ? 'used' : ''}}">
      <h3>{{game_user_card.card.title}}</h3>
      <img class="image image-full" ng-src="images/{{game_user_card.card.image}}" alt="{{game_user_card.card.category}}"
      data-toggle="modal" data-target="#cardModal-{{game_user_card.id}}">

      <!-- the modal for this card -->
      <div class="modal fade" id="cardModal-{{game_user_card.id}}" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
              <h4 class="modal-title" id="myModalLabel">{{game_user_card.card.title}}</h4>
            </div>
            <div class="modal-body">
              <img class="image image-md" ng-src="images/{{game_user_card.card.image}}" alt="{{game_user_card.card.type}}">
              <p>{{game_user_card.card.description}}</p>
            </div>
            <div class="modal-footer">
              <button ng-if="game.checkPhase(2)" class="btn btn-danger pull-left" data-dismiss="modal"
                      ng-click="discardCard(game_user_card)">Discard</button>
              <div class="btn-group">
                <button class="btn btn-primary {{game_user_card.used || !game.checkPhase(2) ? 'disabled' : ''}}" data-dismiss="modal"
                        ng-click="useCard(game_user_card)">Use</button>
                <button class="btn btn-info" data-dismiss="modal">Back</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </li>
  </ul>
</div>

<div ng-if="game.checkPhase(2)" class="bar bar-bottom bar-light">
  <div class="container-fluid">
    <div class="row">
      <div class="col-md-4">
        <p>Existing Rations</p>
        <div>
          <div ng-repeat="ration in rations.$object" class="ration ration-popover clickable pull-left pad-10">
            <div ng-repeat="ingredient in ration.ingredients" class="ration-ingredient {{ingredient.ingredient_cat.name}}"></div>
          </div>
          <div ng-repeat="ration in rations.$object" class="hidden">
            <p>Position: {{ration.position}}</p>
            <ul>
              <li ng-repeat="ingredient in ration.ingredients">
                <span class="label {{ingredient.ingredient_cat.name}}"></span>
              </li>
            </ul>
          </div>
        </div>
      </div>
      <div class="col-md-6">
        <div ng-if="rations.$object.length < 4">
          <div class="big-ration pull-left">
            <div ng-repeat="ingredient in newRation.ingredients" class="ingredient {{ingredient.card.category}}">
              <p>{{ingredient.card.category}}</p>
              <button ng-if="ingredient.card.category != 'empty'" ng-click="newRation.replace(ingredient)" class="btn btn-default btn-xs">replace</button>
            </div>
          </div>
          <button class="btn btn-success pull-left" data-toggle="modal" data-target="#create-ration"
                  style="height: 50px; margin-top: 8px; border-radius: 0px 5px 5px 0px;">Create</button>
        </div>
      </div>
      <div class="col-md-2">
        <button class="btn btn-success pull-right" ng-click="game.nextPhase(3)" data-toggle="tooltip" data-placement="top" title="End card actions">
          Finished
        </button>
      </div>
    </div>
  </div>

  <div class="modal fade" id="create-ration" tabindex="-1" role="dialog" aria-labelledby="create-ration-label" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
          <h4 class="modal-title" id="myModalLabel">Confirm Creation</h4>
        </div>
        <div class="modal-body">
          <p>You are about to create the following ration:</p>
          <div class="big-ration big-ration-full">
            <div ng-repeat="ingredient in newRation.ingredients" class="ingredient {{ingredient.card.category}}">
              <p>{{ingredient.card.category}}</p>
              <p>{{ingredient.card.description}}</p>
            </div>
          </div>
          <p ng-if="newRation.spaces() > 0">This ration has space for {{newRation.spaces()}} more ingredients.</p>
          <p>You will have {{countUnusedIngredients()}} ingredients left. Do you want to continue?</p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Change</button>
          <button ng-if="newRation.spaces() < 4" type="button" class="btn btn-success" ng-click="newRation.create()">Create</button>
        </div>
      </div>
    </div>
  </div>
</div>
</div>
