<div ng-controller="CardsCtrl" class="cards">
<h2>
  Your Hand
  <small>Total <span class="badge">{{user.cards.length}}</span></small>
  <small>Actions <span class="badge">{{countActions()}}</span></small>
  <small>Ingredients <span class="badge">{{countIngredients()}}</span></small>
  <button ng-if="game.checkPhase(2)" class="btn btn-default pull-right" data-toggle="modal" data-target="#help-modal">Help!</button>
</h2>

<div class="modal fade" id="help-modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title">Cards Phase: Help</h4>
      </div>
      <div class="modal-body">
        <p>During this phase you can play cards from your hand, which is the list visible below. There are two types of
        cards: <span class="label label-default">Ingredient</span> cards which you can create a ration with, and
        <span class="label label-default">Action</span> cards, which have a specific result when played. You cannot move
        on from this phase until you have 9 cards or less.</p>
        <p>To use a card, select it, and in the pop-up click the 'Use' button.</p>
        <p>To create a ration (a group of ingredients) select several ingredients, and when ready, click create by the
          ration container in the middle of the control bar. You will be asked to confirm your choice, then the ration
          will be created with the chosen ingredients.</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<script type="text/ng-template" id="cardDiscard.html">
  <div class="modal-header">
    <h4 class="modal-title">Are you sure?</h4>
  </div>
  <div class="modal-body">
    <p>Are you sure you want to discard the card '{{game_user_card.game_card.card.title}}'?</p>
  </div>
  <div class="modal-footer">
    <div class="btn-group">
      <button class="btn btn-danger {{game_user_card.used ? 'disabled' : ''}}"
              ng-click="discard()">Yes</button>
      <button ng-click="cancel()" class="btn btn-info">Back</button>
    </div>
  </div>
</script>

<script type="text/ng-template" id="cardDetails.html">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
      <span aria-hidden="true">&times;</span>
    </button>
    <h4 class="modal-title" id="myModalLabel">{{card.title}}</h4>
  </div>
  <div class="modal-body">
    <img class="image image-md" ng-src="images/{{card.image}}" alt="{{card.type}}">
    <p ng-if="card.category == 'action'"><strong>Action:</strong> This card is an action card, it can be played at any time. It will cause an effect and then be used up.</p>
    <p ng-if="card.category != 'action'"><strong>Ingredient:</strong> This card is an ingredient, it is 1 of 5 types that can be used to make food rations.</p>
    <p><strong>Points:</strong> {{card.points}}</p>
    <div><strong>Description:</strong> <div ng-bind-html="card.description"></div></div>
  </div>
  <div class="modal-footer">
    <div class="btn-group">
      <button class="btn btn-primary {{game_user_card.used || (!game.canAct(2) && card.category != 'action') ? 'disabled' : ''}}"
              ng-click="use()">Use</button>
      <button ng-click="cancel()" class="btn btn-info">Back</button>
    </div>
  </div>
</script>

<div class="well well-sm">
  <ul id="cards-list" class="list-inline">
    <li ng-repeat="game_user_card in user.cards" class="{{game_user_card.used ? 'used' : ''}}">
        <h3>
          {{game_user_card.game_card.card.title}}
        </h3>
      <img class="image image-full" ng-src="images/{{game_user_card.game_card.card.image}}"
            alt="{{game_user_card.game_card.card.category}}" ng-click="view(game_user_card)">
      <div>
        <button class="btn btn-danger btn-sm pull-left" ng-click="discard(game_user_card)">Discard</button>
        <button class="btn btn-info btn-sm pull-right" ng-click="view(game_user_card)">Details</button>
      </div>
    </li>
  </ul>
</div>

<div ng-if="game.canAct(2)" class="bar bar-bottom bar-light">
  <div class="container-fluid">
    <div class="row">
      <div class="col-md-4">
        <p>Existing Rations</p>
        <div>
          <div ng-repeat="ration in user.rations" class="ration ration-popover clickable pull-left pad-10">
            <div ng-repeat="ingredient in ration.ingredients" class="ration-ingredient {{ingredient.ingredient_cat.name}}"></div>
          </div>
          <div ng-repeat="ration in user.rations" class="hidden">
            <p>Position: {{ration.position}}</p>
            <ul>
              <li ng-repeat="ingredient in ration.ingredients">
                <span class="label {{ingredient.ingredient_cat.name}}"></span>
              </li>
            </ul>
          </div>
        </div>
      </div>
      <div class="col-md-6">
        <div ng-if="newRation.show()">
          <div class="big-ration pull-left">
            <div ng-repeat="ingredient in newRation.ingredients" class="ingredient {{ingredient.game_card.card.category}}">
              <p>{{ingredient.game_card ? ingredient.game_card.card.category : 'empty'}}</p>
              <button ng-if="ingredient.game_card" ng-click="newRation.replace(ingredient)" class="btn btn-default btn-xs">replace</button>
            </div>
          </div>
          <button class="btn btn-success pull-left" ng-click="confirmCreation()"
                  style="height: 50px; margin-top: 8px; border-radius: 0px 5px 5px 0px;">Create</button>
        </div>
      </div>
      <div class="col-md-2">
        <button ng-if="user.cards.length <= 9" class="btn btn-success pull-right" ng-click="game.doneTurn()"
                data-toggle="tooltip" data-placement="top" title="End card actions">
          Finished
        </button>
        <p ng-if="user.cards.length > 9">You must discard cards to continue.</p>
      </div>
    </div>
  </div>
</div>
</div>

<script type="text/ng-template" id="createRation.html">
    <div class="modal-header">
      <button type="button" class="close" ng-click="cancel()">
        <span aria-hidden="true">&times;</span>
      </button>
      <h4 class="modal-title" id="createRationLabel">ConfirmCreation</h4>
    </div>
    <div class="modal-body">
      <p>You are about to create the following ration:</p>
      <div class="big-ration big-ration-full">
        <div ng-repeat="ingredient in ingredients" class="ingredient {{ingredient.game_card.card.category}}">
          <p>{{ingredient.game_card.card.category}}</p>
          <div ng-bind-html="ingredient.game_card.card.description"></div>
        </div>
      </div>
      <p ng-if="canCreate">This ration has space for {{spaces}} more ingredients.</p>
      <p ng-if="canCreate">You will have {{unUsed}} ingredients left. Do you want to continue?</p>
      <p ng-if="!canCreate">You need to add at least 1 ingredient to create a ration.</p>
    </div>
    <div class="modal-footer">
      <div class="btn-group">
        <button ng-if="canCreate" type="button"
                class="btn btn-success" ng-click="create()">Create</button>
        <button type="button" class="btn btn-info" ng-click="cancel()">Back</button>
      </div>
    </div>
</script>
</div>
</div>
