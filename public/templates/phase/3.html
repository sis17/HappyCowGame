<div ng-controller="MovementCtrl" class="movement">
  <img id="game-board" class="game-board-item" ng-src="images/cow-body-{{game.cow.body_condition < -1 ? 'thin' : (game.cow.body_condition > 1 ? 'fat' : 'normal')}}.png"
      style="width: {{width}}px; left: {{left}}px; top: {{top}}px">
  <img class="game-board-item top" ng-src="images/happycow{{game.cow.welfare > 4 ? '-happy' : (game.cow.welfare < -2 ? '-ill' : (game.cow.welfare < -5 ? '-veryill' : ''))}}.png"
      style="left: {{left+8}}px; top: {{top+205}}px; width:165px;">
  <div id="game-board-rumen" class="game-board-item below" style="left: {{left+275}}px; top: {{top+55}}px;
        background-color:rgb(255,{{ph_colour}},{{ph_colour}})"></div>

  <div class="game-board-item below {{game.cow.pregnancy_id > 0 ? 'meat' : 'milk'}}-background"
        style="left: {{left+680}}px; top: {{top+170}}px; width: 40px; height: 34px;"></div>
  <div class="game-board-item top {{game.cow.pregnancy_id > 0 ? 'meat' : 'milk'}}"
        style="left: {{left+655}}px; top: {{top+205}}px;">{{game.cow.pregnancy_id > 0 ? 'meat' : 'milk'}}</div>
  <div class="game-board-item below meat-background"
        style="left: {{left+730}}px; top: {{top+280}}px; width: 60px; height: 45px;"></div>
  <div class="game-board-item top meat" style="left: {{left+695}}px; top: {{top+297}}px;">meat</div>

  <div popup class="game-board-item top" style="left: {{left+310}}px; top: {{top+260}}px; width: 200px;" template="popup_rumen">
      <span class="label label-{{rumenStat.minType}} cow-pl cow-pl-low">{{rumenStat.min}}</span>
      <div class="progress cow-progress" style="width: 70%">
        <div class="progress-bar" role="progressbar"
          aria-valuemin="{{rumenStat.min}}" aria-valuemax="{{rumenStat.max}}"
          style="background-color: #{{rumenStat.type()}};
          width: {{((rumenStat.value-rumenStat.min)/(rumenStat.max-rumenStat.min)) * 100}}%;">
          {{rumenStat.value}}
        </div>
    </div>
    <span class="label label-{{rumenStat.maxType}} cow-pl cow-pl-high">{{rumenStat.max}}</span>
  </div>

  <div ng-repeat="ration in game.allRations" class="ration ration-board clickable"
        ng-click="selectRation(ration)"
        style="left: {{left+ration.position.centre_x-10}}px; top: {{top+ration.position.centre_y-10}}px;
        border-color:{{ration.game_user.colour}}; background-color:{{ration.id == player.move.ration.id ? ration.game_user.colour : ''}};">
    <div ng-repeat="ingredient in ration.ingredients" class="ration-ingredient {{ingredient.ingredient_cat.name}}"></div>
  </div>

  <img ng-repeat="motile in game.motiles" ng-src="images/motile.png" class="motile clickable"
        style="left: {{left+motile.position.centre_x-10}}px; top: {{top+motile.position.centre_y-10}}px;" />

  <div ng-repeat="pos in possiblePositions" ng-if="pos.depth > 0"
        class="move-position {{pos.depth == 1 && !moving ? 'move-position-first clickable' : ''}}
        {{pos.depth >= player.move.movements_left && !moving ? 'move-position-first clickable' : ''}}"
        style="left: {{left+pos.centre_x}}px; top: {{top+pos.centre_y}}px; padding-left:3px;"
        ng-click="moveRation(pos.id, pos.depth >= player.move.movements_left)">{{pos.depth}}
        {{pos.rations.length > 0 ? 'pushable' : ''}}
  </div>

  <div id="board-controls">
    <div class="btn-group hidden">
      <button ng-click="zoomIn()" class="btn btn-default"><span class="glyphicon glyphicon-zoom-in"></span></button>
      <button ng-click="zoomOut()" class="btn btn-default"><span class="glyphicon glyphicon-zoom-out"></span></button>
    </div><br/>
    <div class="btn-group">
      <button ng-click="moveLeft()" class="btn btn-default"><span class="glyphicon glyphicon-arrow-left"></span></button>
      <button ng-click="moveRight()" class="btn btn-default"><span class="glyphicon glyphicon-arrow-right"></span></button>
    </div>
    <div class="btn-group-vertical">
      <button ng-click="moveUp()" class="btn btn-default"><span class="glyphicon glyphicon-arrow-up"></span></button>
      <button ng-click="moveDown()" class="btn btn-default"><span class="glyphicon glyphicon-arrow-down"></span></button>
    </div>
  </div>

  <div ng-if="game.checkPhase(3) && game.checkTurn()" class="bar bar-bottom bar-light">
    <div class="area pull-left">
      <p ng-if="getStage() == 0">{{player.getName()}}, you have no food rations to move. Next turn try creating one with ingredient cards.</p>
      <p ng-if="getStage() == 1">{{player.getName()}}, select a ration on the board that you want to move.</p>
      <p ng-if="getStage() == 2">Now confirm it, and you'll get a choice of dice to use.</p>
      <p ng-if="getStage() == 3">Select a dice, you will be able to move the value shown.</p>
      <p ng-if="getStage() == 4">If you're happy with that dice, click on one of the positions shown in green to start moveing.</p>
      <p ng-if="getStage() == 5">You've started moving your ration, you must now move as far as possible.</p>
      <p ng-if="getStage() == 6">You cannot move any further, your turn is finished.</p>
    </div>

    <div class="area pull-right">
      <div ng-if="getStage() == 0 || getStage() == 6" class="pull-right">
        <button ng-click="game.doneTurn()" class="btn btn-primary">Finish</button>
      </div>
      <div ng-if="getStage() == 2" class="pull-right"><button ng-click="confirmRation()" class="btn btn-sm btn-primary">Confirm</button></div>
      <div ng-if="getStage() == 3 || getStage() == 4 || getStage() == 5">
        <ul class="list-inline pull-right pad-10">
          <li ng-repeat="die in dice">
            <a ng-click="die.select()" class="{{die.class()}} clickable">
              <div class="die {{die.doubleClass}} {{die.waterClass}}">
                <div class="die-value die-value-{{die.value}}"></div>
              </div>
            </a>
          </li>
        </ul>
      </div>
    </div>
  </div>
</div>
